<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <meta name="description" content="Aframe-Material">
    <script src="https://aframe.io/releases/0.7.0/aframe.js"></script>
    <script src="https://rawgit.com/mayognaise/aframe-mouse-cursor-component/master/dist/aframe-mouse-cursor-component.min.js"></script>
    <script src="https://cdn.rawgit.com/zcanter/aframe-gradient-sky/master/dist/gradientsky.min.js"></script>
    <script src="dist/aframe-material.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.13.0/d3.min.js"></script>
	<script src="./aframe-ammo.min.js"></script>
	<script src="https://rawgit.com/feiss/aframe-environment-component/master/dist/aframe-environment-component.min.js"></script>
    <script type="text/javascript">
      AFRAME.ASSETS_PATH = "./assets";
    </script>
  </head>
  <body>
      <a-scene ammo-world cursor="rayOrigin: mouse">
	  <a-assets>
		 <a-asset-item id="stacks" src="./assets/money/scene.gltf" ></a-asset-item>
		 <a-asset-item id="male_model" src="./assets/male/scene.gltf" ></a-asset-item>
		 <a-asset-item id="female_model" src="./assets/female/scene.gltf" ></a-asset-item>
	  </a-assets>
      <!-- BEGIN ENVIRONEMENT -->
	  <a-gradient-sky material="shader: gradient; topColor: 128 75 255; bottomColor: 255 180 0;"></a-gradient-sky>
      <a-box ammo-controls='mass: 0' position="0 -5 -19" width="4" height="0.1" depth='4' restitution="0.0" scale='10 10 10' color="#7BC8A4" visible="false"></a-box>
      <!-- END ENVIRONEMENT -->
      <a-entity laser-controls="hand: right"></a-entity>
      <a-entity position="0 8 0"> <a-camera mouse-cursor></a-camera></a-entity>
	  <!--- LIGHT SETUPS --->
	  <a-entity position="0.358 24.533 -40" light="intensity:1.8;angle:40;type:spot;color:#ffe7ed; castShadow: true" rotation="-135 1.93 0"></a-entity>
	  <a-entity light="angle:50;type:ambient"></a-entity>
      <!-- BEGIN INPUTS/KEYBOARD -->
      <a-keyboard></a-keyboard>
      <a-input position="-0.7 10 -2.5" placeholder="1 = $10,000" color="black" width="1"></a-input>
	  <a-button position="-0.7 9.7 -2.5" name="stuff" scale="0.5 0.5 0.5" value="Enter" type="raised"></a-button>
	  <a-checkbox position="-0.1 9.73 -2.5" name="stuff" scale="0.5 0.5 0.5" label="ModelForScale" type="raised" checked="false" color="#FFF"></a-button>
      
	  <!---<a-entity gltf-model="#male_model" position="-13.474 5.683 -18.878" rotation="0 45 0" scale="10 10 10"></a-entity>--->
      </a-scene>
      <script type="text/javascript">
	  var count = 0;
	  let input = document.querySelector('a-input');
	  let keyboard = document.querySelector("a-keyboard");
		input.addEventListener('click', () => {
			keyboard.open();
			keyboard.setAttribute("position","-1.5 8.8 -2.5");
		});
	  let checkbox = document.querySelector('a-checkbox');
	  checkbox.addEventListener('change', () => {
	  	var status = checkbox.getAttribute("checked");
	  	console.log(typeof status);
			if(status === "true") {
				var el = document.createElement("a-entity");
				el.setAttribute("gltf-model","#female_model");
				el.setAttribute("position","-13.474 5.683 -25.878");
				el.setAttribute("rotation","0 45 0");
				el.setAttribute("scale","10 10 10");
				el.setAttribute("id","model");
				document.querySelector('a-scene').appendChild(el);
				
				
			}
			else { 
				var e = document.getElementById("model");
				e.parentNode.removeChild(e);	
			
						
			}
				
	  });
      let button = document.querySelector('a-button');
      button.addEventListener('click', ()=> {
		  keyboard.dismiss();
		  
		  var e = document.querySelectorAll("a-entity");
		  //14 = number of a-entity that are not generated by D3.js
              
		  //console.log(e);
		  
		  if(e.length>=14){
			  for(var i=14;i<e.length;i++){
				  console.log(e[i].id);
				  if(e[i].id!="model")
				  {
				  	e[i].parentNode.removeChild(e[i]);
				  }
			  }
		  }
		  
		  var input_text = document.querySelector("a-input");
		  var str = input_text.getAttribute("value");
		  var num = parseInt(input_text.getAttribute("value"));
		  console.log(str,num);
		  var data = [];
		  for(var i=0;i<num;i++){
			  data[i] = i+1;
		}
	
		  var scene = d3.select("a-scene");
		  var dollars = scene.selectAll("a-scene").data(data)
						.enter()
						//.append('a-entity',{
						//	id: "stax"
						//})
		  				.append('a-entity')
						.attr("geometry","primitive: box; width: 257.9; height: 25; depth: 112.16")
						.attr("ammo-controls",{
							linearVelocity: "0 0 0",
							angularVelocity: "0 60 60", //default : "0 0 0"
							restitution: "0.0",
							friction: "2"
						})
		  				.attr("shadow",{
							cast: "true",
							receive: "true"
						})
						.attr('gltf-model',"#stacks")
						.attr('scale',"0.01 0.01 0.01")
						.attr('position', function(d,i){
							var height = 20;
							var x = i%3 * 3;
							var y = parseInt(i/9*0.5+height,10);
							var z = parseInt(i/3)%3-22 ;
							return x+" "+y+" "+z;
						});
		
      });
		
    </script>
  </body>
</html>
